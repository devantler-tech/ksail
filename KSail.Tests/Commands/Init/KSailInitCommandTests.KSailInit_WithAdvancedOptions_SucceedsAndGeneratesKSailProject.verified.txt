{
  k8s/apps/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- podinfo
components:
- ../components/helm-release-crds-label
- ../components/helm-release-remediation-label
,
  k8s/clusters/ksail-default/flux-system/apps.yaml:
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  labels:
    sops: enabled
    post-build-variables: enabled
  name: apps
  namespace: flux-system
spec:
  interval: 60m
  retryInterval: 2m
  timeout: 3m
  dependsOn:
  - name: infrastructure
  sourceRef:
    kind: OCIRepository
    name: flux-system
  path: apps
  prune: true
  wait: true
,
  k8s/clusters/ksail-default/flux-system/infrastructure-controllers.yaml:
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  labels:
    sops: enabled
    post-build-variables: enabled
  name: infrastructure-controllers
  namespace: flux-system
spec:
  interval: 60m
  retryInterval: 2m
  timeout: 3m
  dependsOn:
  - name: variables
  sourceRef:
    kind: OCIRepository
    name: flux-system
  path: infrastructure/controllers
  prune: true
  wait: true
,
  k8s/clusters/ksail-default/flux-system/infrastructure.yaml:
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  labels:
    sops: enabled
    post-build-variables: enabled
  name: infrastructure
  namespace: flux-system
spec:
  interval: 60m
  retryInterval: 2m
  timeout: 3m
  dependsOn:
  - name: infrastructure-controllers
  sourceRef:
    kind: OCIRepository
    name: flux-system
  path: infrastructure
  prune: true
  wait: true
,
  k8s/clusters/ksail-default/flux-system/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- apps.yaml
- infrastructure.yaml
- infrastructure-controllers.yaml
- variables.yaml
components:
- ../../../components/flux-kustomization-post-build-variables-label
- ../../../components/flux-kustomization-sops-label
,
  k8s/clusters/ksail-default/flux-system/variables.yaml:
---
apiVersion: kustomize.toolkit.fluxcd.io/v1
kind: Kustomization
metadata:
  labels:
    sops: enabled
  name: variables
  namespace: flux-system
spec:
  interval: 60m
  retryInterval: 2m
  timeout: 3m
  dependsOn: []
  sourceRef:
    kind: OCIRepository
    name: flux-system
  path: variables
  prune: true
  wait: true
,
  k8s/components/flux-kustomization-post-build-variables-label/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
- patch: |-
    apiVersion: kustomize.toolkit.fluxcd.io/v1
    kind: Kustomization
    metadata:
      name: all
    spec:
      postBuild:
        substituteFrom:
        - kind: ConfigMap
          name: variables-cluster
        - kind: Secret
          name: variables-sensitive-cluster
  target:
    kind: Kustomization
    labelSelector: kustomize.toolkit.fluxcd.io/post-build-variables=enabled
,
  k8s/components/flux-kustomization-sops-label/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
- patch: |-
    apiVersion: kustomize.toolkit.fluxcd.io/v1
    kind: Kustomization
    metadata:
      name: all
    spec:
      decryption:
      provider: sops
      secretRef:
        name: sops-age
  target:
    kind: Kustomization
    labelSelector: sops=enabled
,
  k8s/components/helm-release-crds-label/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
- patch: |-
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: all
    spec:
      install:
        crds: CreateReplace
      upgrade:
        crds: CreateReplace
  target:
    kind: HelmRelease
    labelSelector: helm.toolkit.fluxcd.io/crds=enabled
,
  k8s/components/helm-release-remediation-label/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component
patches:
- patch: |-
    apiVersion: helm.toolkit.fluxcd.io/v2
    kind: HelmRelease
    metadata:
      name: all
    spec:
      install:
        remediation:
          retries: 10
      upgrade:
        remediation:
          retries: 10
  target:
    kind: HelmRelease
    labelSelector: helm.toolkit.fluxcd.io/remediation=enabled
,
  k8s/infrastructure/controllers/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- cert-manager
- traefik
components:
- ../../components/helm-release-crds-label
- ../../components/helm-release-remediation-label
,
  k8s/infrastructure/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- certificates
- cluster-issuers
components:
- ../components/helm-release-crds-label
- ../components/helm-release-remediation-label
,
  k8s/variables/kustomization.yaml:
---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
- variables.yaml
- variables-sensitive.sops.yaml
components:
- ../components/helm-release-crds-label
- ../components/helm-release-remediation-label
,
  k8s/variables/variables-sensitive.sops.yaml:
---
apiVersion: v1
kind: Secret
metadata:
  name: variables-sensitive
  namespace: flux-system
stringData: {}
,
  k8s/variables/variables.yaml:
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: variables
  namespace: flux-system
data: {}
,
  kind-config.yaml:
---
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
name: ksail-default
containerdConfigPatches:
- >-
  [plugins."io.containerd.grpc.v1.cri".registry]
    config_path = "/etc/containerd/certs.d"
,
  ksail-config.yaml:
---
apiVersion: ksail.io/v1alpha1
kind: Cluster
metadata:
  name: ksail-default
spec:
  kubeconfig: ~/.kube/config
  context: kind-ksail-default
  timeout: 5m
  manifestsDirectory: ./k8s
  kustomizationDirectory: ./k8s/clusters/ksail-default/flux-system
  configPath: kind-config.yaml
  distribution: kind
  gitOpsTool: flux
  containerEngine: docker
  sops: true
  registries:
  - name: ksail-registry
    hostPort: 5555
    isGitOpsOCISource: true
    provider: docker
  - name: registry.k8s.io
    hostPort: 5556
    isGitOpsOCISource: false
    proxy:
      url: https://registry.k8s.io/
      insecure: false
    provider: docker
  - name: docker.io
    hostPort: 5557
    isGitOpsOCISource: false
    proxy:
      url: https://registry-1.docker.io/
      insecure: false
    provider: docker
  - name: ghcr.io
    hostPort: 5558
    isGitOpsOCISource: false
    proxy:
      url: https://ghcr.io/
      insecure: false
    provider: docker
  - name: gcr.io
    hostPort: 5559
    isGitOpsOCISource: false
    proxy:
      url: https://gcr.io/
      insecure: false
    provider: docker
  - name: mcr.microsoft.com
    hostPort: 5560
    isGitOpsOCISource: false
    proxy:
      url: https://mcr.microsoft.com/
      insecure: false
    provider: docker
  - name: quay.io
    hostPort: 5561
    isGitOpsOCISource: false
    proxy:
      url: https://quay.io/
      insecure: false
    provider: docker
  checkOptions: {}
  debugOptions:
    editor: nano
  downOptions:
    registries: false
  genOptions: {}
  initOptions:
    declarativeConfig: true
    components: true
    helmReleases: true
    postBuildVariables: true
    outputDirectory: {TempPath}ksail-init-advanced
    template: simple
    kustomizeFlows:
    - apps
    - infrastructure
    - infrastructure/controllers
    kustomizeHooks: []
  lintOptions: {}
  listOptions:
    all: false
  sopsOptions:
    listOptions:
      showPublicKey: true
      showPrivateKey: true
  startOptions: {}
  stopOptions: {}
  upOptions:
    destroy: false
    lint: true
    reconcile: true
  updateOptions:
    lint: true
    reconcile: true

}
