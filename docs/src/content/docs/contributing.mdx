---
title: Contributing
description: Guidelines for contributing to KSail
---

KSail accepts contributions in the form of **bug reports**, **feature requests**, and **pull requests**. If you're looking to contribute code, please follow the guidelines outlined in this document.

## Getting Started

To get started with contributing to KSail, you'll need to set up your development environment, understand the codebase, and familiarize yourself with the CI setup and its requirements.

For detailed package and API documentation, refer to the Go documentation at [pkg.go.dev/github.com/devantler-tech/ksail/v5](https://pkg.go.dev/github.com/devantler-tech/ksail/v5).

## Development Prerequisites

Before you begin, ensure you have the following installed:

- [Go (v1.25.4+)](https://go.dev/doc/install)
- [mockery](https://vektra.github.io/mockery/v3.5/installation/)
- [golangci-lint](https://golangci-lint.run/docs/welcome/install/)
- [mega-linter](https://megalinter.io/latest/mega-linter-runner/#installation)
- [Docker](https://www.docker.com/get-started/)

For building documentation:

- [Node.js (v22+)](https://nodejs.org/en/download/) (matches CI)

## Development Workflow

### Linting

KSail uses mega-linter with the Go flavor and a strict configuration to ensure code quality and consistency:

```sh
# working-directory: ./
mega-linter-runner -f go
```

The same configuration is used in CI, so you can expect the same linting behavior locally as in the CI pipeline.

MegaLinter also checks Markdown files. Markdown lint rules are configured in `.markdownlint.json` (some rules are relaxed to accommodate Astro/Starlight front matter and documentation formatting).

### Building

```sh
# working-directory: ./
# Build the ksail binary
go build -o ksail

# Or: compile all packages (no binary output)
go build ./...
```

### Testing

#### Generating mocks

```sh
# working-directory: ./
mockery
```

#### Unit tests

```sh
# working-directory: ./
go test ./...
```

#### System Tests

System tests are configured in `.github/workflows/ci.yaml` and run in GitHub's **merge queue** (the `merge_group` event). They do **not** run on regular `pull_request` checks; instead they gate the final merge to `main` when a PR enters the merge queue.

#### Hetzner Provider Testing

To test the Hetzner provider locally, you need:

- **`HCLOUD_TOKEN`** – Hetzner Cloud API token with read/write permissions
- **Talos ISO** – A Talos Linux ISO must be available in your Hetzner Cloud project (default ID: `122630`)

> [!WARNING]
> Some unit tests and CLI code paths enable Hetzner functionality when `HCLOUD_TOKEN` is set. If you're not intentionally testing Hetzner, unset `HCLOUD_TOKEN` (or set it to an empty value) before running `go test ./...` to keep tests hermetic.

> [!WARNING]
> Hetzner tests incur cloud costs. Use `ksail cluster delete` to clean up resources.

> [!NOTE]
> CI includes a safety-net cleanup job (`cleanup-hetzner`) that runs after system tests and deletes any Hetzner resources labeled `ksail.owned=true` via `.github/scripts/cleanup-hetzner.sh`.

If a local run is interrupted and you need to remove leftover CI-labeled resources, you can run:

```sh
HCLOUD_TOKEN=... .github/scripts/cleanup-hetzner.sh
```

> [!WARNING]
> The cleanup script is destructive and will delete *all* resources in your Hetzner project matching `ksail.owned=true`. Only run it if you understand the scope.

## Documentation

The project documentation is built using [Astro](https://astro.build/) with the [Starlight](https://starlight.astro.build/) theme and is located in the `docs/` directory.

### Auto-generated Reference Docs

Some documentation is generated from source and should **not** be edited manually:

- **CLI flags reference:** `docs/src/content/docs/cli-flags/` (generated by `.github/scripts/generate-cli-flags-docs.sh` from `ksail --help` output)
- **Configuration schema:** `schemas/ksail-config.schema.json` (generated by `.github/scripts/generate-schema.sh`)

To regenerate locally:

```sh
# working-directory: ./
go build -o ksail

# Generate reference docs
.github/scripts/generate-cli-flags-docs.sh
.github/scripts/generate-schema.sh
```

### Building the Documentation

```sh
# working-directory: ./docs

# Install dependencies (first time only or when package-lock.json changes)
npm ci

# Build the site
npm run build

# Serve the site locally with live reload (optional)
npm run dev
# Visit http://localhost:4321 to view the site
```

The built site will be available in `docs/dist/`. Note that `docs/dist/` and `docs/node_modules/` are excluded from git via `.gitignore`.

## Project Structure

The repository is organized around the top-level CLI entry point (`main.go`) and the public packages in `pkg/`.

- **main.go** - CLI entry point
- **pkg/cli/cmd/** - CLI command implementations
- **pkg/** - Public packages (importable by external projects)

### Key Packages in pkg/

- **apis/** - API types, schemas, and enums (distribution/provider values)
- **client/** - Embedded tool clients (kubectl, helm, kind, k3d, flux, argocd)
- **svc/provider/** - Infrastructure providers (e.g., `docker.Provider` for running nodes as containers)
- **svc/provisioner/** - Distribution provisioners (Vanilla, K3s, Talos)
- **svc/installer/** - Component installers (CNI, CSI, metrics-server, etc.)
- **di/** - Dependency injection for wiring components

### Architecture: Providers vs Provisioners

KSail separates infrastructure management from distribution configuration:

- **Providers** manage the infrastructure lifecycle (start/stop containers or cloud servers)
- **Provisioners** configure and manage Kubernetes distributions

| Distribution | Provisioner            | Tool  | Provider        | Description                  |
|--------------|------------------------|-------|-----------------|------------------------------|
| `Vanilla`    | KindClusterProvisioner | Kind  | Docker          | Standard upstream Kubernetes |
| `K3s`        | K3dClusterProvisioner  | K3d   | Docker          | Lightweight K3s in Docker    |
| `Talos`      | TalosProvisioner       | Talos | Docker, Hetzner | Immutable Talos Linux        |

This project strives to be fully open-source friendly, and as such, all core functionality is implemented in the `pkg/` directory. The `internal/` directory is not used, allowing external projects to import and use any part of the codebase.

For detailed package and API documentation, refer to [pkg.go.dev/github.com/devantler-tech/ksail/v5](https://pkg.go.dev/github.com/devantler-tech/ksail/v5).

## CI/CD

### Continuous Integration

#### Unit Tests

```sh
# working-directory: ./
go test ./...
```

#### System Tests

System tests are configured in `.github/workflows/ci.yaml` and run in GitHub's **merge queue** (the `merge_group` event). They do **not** run on regular `pull_request` checks; instead they gate the final merge to `main` when a PR enters the merge queue.

### Continuous Deployment

#### Release Process

The release process for KSail is fully automated and split across two GitHub Actions workflows:

1. **Release** (`.github/workflows/release.yaml`) runs on pushes to `main` and creates the next semantic version tag (`vX.Y.Z`) based on Conventional Commits (typically the PR title / squash-merge commit message).
2. **CD - Go** (`.github/workflows/cd.yaml`) runs on tag pushes (`v*`) and uses **GoReleaser** to build and publish release artifacts.

Versioning conventions:

- **fix:** Patch release (e.g. 1.0.1)
- **feat:** Minor release (e.g. 1.1.0)
- **BREAKING CHANGE** or **`!`**: Major release (e.g. 2.0.0)

The changelog is generated by **GoReleaser** from the commit history, so keep PR titles and commit messages clear and descriptive.

## Submitting Contributions

1. **Fork** the repository on GitHub
2. **Clone** your fork locally
3. **Create a branch** for your changes
4. **Make your changes** following the guidelines above
5. **Run tests and linters** to ensure quality
6. **Commit** with clear, descriptive messages (following Conventional Commits)
7. **Push** to your fork
8. **Open a pull request** to the `main` branch

Your PR will be reviewed by maintainers. System tests will run in the merge queue before final merge.

## Getting Help

- **Issues?** Open an [issue](https://github.com/devantler-tech/ksail/issues) in the repository
- **Questions?** Start a [discussion](https://github.com/devantler-tech/ksail/discussions) in the repository
- **Security?** See [SECURITY.md](https://github.com/devantler-tech/ksail/blob/main/SECURITY.md)
